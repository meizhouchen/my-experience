import{_ as s,o as a,c as n,O as e}from"./chunks/framework.3938e08f.js";const l="/my-experience/assets/1.5b22a25a.jpg",o="/my-experience/assets/2.db9cb038.jpg",A=JSON.parse('{"title":"zookeeper","description":"","frontmatter":{},"headers":[],"relativePath":"back-end/microservice/zookeeper/zookeeper.md","filePath":"back-end/microservice/zookeeper/zookeeper.md"}'),p={name:"back-end/microservice/zookeeper/zookeeper.md"},t=e('<h1 id="zookeeper" tabindex="-1">zookeeper <a class="header-anchor" href="#zookeeper" aria-label="Permalink to &quot;zookeeper&quot;">​</a></h1><p><a href="http://www.taodudu.cc/news/show-1773986.html?action=onClick" target="_blank" rel="noreferrer">ZooKeeper的安装、配置、启动和使用</a><a href="https://blog.csdn.net/weixin_45926962/article/details/127819319" target="_blank" rel="noreferrer">zookeeper在Windows中的启动操作及设置服务自启动</a><a href="https://blog.csdn.net/weixin_48526216/article/details/126689548" target="_blank" rel="noreferrer">Windows下安装zookeeper</a></p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><h3 id="windows" tabindex="-1">windows <a class="header-anchor" href="#windows" aria-label="Permalink to &quot;windows&quot;">​</a></h3><p><a href="https://blog.51cto.com/u_13348545/6264654" target="_blank" rel="noreferrer"></a></p><ol><li><p>下载 <a href="https://dlcdn.apache.org/zookeeper/" target="_blank" rel="noreferrer">官方地址</a> 从国内开源网站下载镜像，例如：清华大学开源软件镜像站 | Tsinghua Open Source Mirror <a href="https://blog.csdn.net/weixin_48526216/article/details/126689548" target="_blank" rel="noreferrer">镜像地址</a><img src="'+l+`" alt=""></p></li><li><p>解压下载的文件 解压即可使用，免安装</p></li></ol><p>打开Windows PowerShell 执行解压：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-zxvf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;">\\a</span><span style="color:#C3E88D;">pache-zookeeper-3.6.3-bin.tar.gz</span></span></code></pre></div><ol start="3"><li>修改配置</li></ol><ul><li>进入conf目录，复制一份zoo_sample.cfg 为 zoo_sample-副本.cfg</li><li>重命名 zoo_sample-副本.cfg 为 zoo.cfg</li></ul><p>找到dataDir=/tmp/zookeeper，修改dataDir，增加dataLogDir。E:\\app\\apache-zookeeper-3.8.1-bin为软件路径</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># dataDir=/tmp/zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;">dataDir=E:\\app\\apache-zookeeper-3.8.1-bin\\data</span></span>
<span class="line"><span style="color:#A6ACCD;">dataLogDir=E:\\app\\apache-zookeeper-3.8.1-bin\\log</span></span></code></pre></div><ol start="4"><li>运行 执行bin目录下 zkServer.cmd <img src="`+o+`" alt=""></li></ol><blockquote><p>坑 执行闪退 编辑zkServer.cmd文件,末尾添加pause</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">setlocal</span></span>
<span class="line"><span style="color:#A6ACCD;">call &quot;%~dp0zkEnv.cmd&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">set ZOOMAIN=org.apache.zookeeper.server.quorum.QuorumPeerMain</span></span>
<span class="line"><span style="color:#A6ACCD;">set ZOO_LOG_FILE=zookeeper-%USERNAME%-server-%COMPUTERNAME%.log</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">echo on</span></span>
<span class="line"><span style="color:#A6ACCD;">call %JAVA% &quot;-Dzookeeper.log.dir=%ZOO_LOG_DIR%&quot; &quot;-Dzookeeper.log.file=%ZOO_LOG_FILE%&quot; &quot;-XX:+HeapDumpOnOutOfMemoryError&quot; &quot;-XX:OnOutOfMemoryError=cmd /c taskkill /pid %%%%p /t /f&quot; -cp &quot;%CLASSPATH%&quot; %ZOOMAIN% &quot;%ZOOCFG%&quot; %*</span></span>
<span class="line"><span style="color:#A6ACCD;">pause</span></span>
<span class="line"><span style="color:#A6ACCD;">endlocal</span></span></code></pre></div><p>如果出现Error: JAVA_HOME is not set.，需要安装java环境 <a href="https://www.runoob.com/java/java-environment-setup.html" target="_blank" rel="noreferrer">安装java教程</a></p><h3 id="linux" tabindex="-1">linux <a class="header-anchor" href="#linux" aria-label="Permalink to &quot;linux&quot;">​</a></h3><ol><li>配置 Java 环境（如未安装）</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-ivh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jdk-8u341-linux-x64.rpm</span></span></code></pre></div><ol start="2"><li>解压安装包</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-zxvf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apache-zookeeper-3.8.0-bin.tar.gz</span></span></code></pre></div><ol start="3"><li><p>修改配置</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apache-zookeeper-3.8.0-bin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 准备配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">zoo_sample.cfg</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">zoo.cfg</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 调整配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">zoo.cfg</span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># The number of milliseconds of each tick</span></span>
<span class="line"><span style="color:#A6ACCD;">tickTime</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2000</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># The number of ticks that the initial</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># synchronization phase can take</span></span>
<span class="line"><span style="color:#A6ACCD;">initLimit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># The number of ticks that can pass between</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># sending a request and getting an acknowledgement</span></span>
<span class="line"><span style="color:#A6ACCD;">syncLimit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># the directory where the snapshot is stored.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># do not use /tmp for storage, /tmp here is just</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># example sakes.</span></span>
<span class="line"><span style="color:#A6ACCD;">dataDir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/soft/apache-zookeeper-3.8.0-bin/data</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># the port at which the clients will connect</span></span>
<span class="line"><span style="color:#A6ACCD;">clientPort</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2181</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># the maximum number of client connections.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># increase this if you need to handle more clients</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#maxClientCnxns=60</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Be sure to read the maintenance section of the</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># administrator guide before turning on autopurge.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># The number of snapshots to retain in dataDir</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#autopurge.snapRetainCount=3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Purge task interval in hours</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Set to &quot;0&quot; to disable auto purge feature</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#autopurge.purgeInterval=1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## Metrics Providers</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># https://prometheus.io Metrics Exporter</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#metricsProvider.httpHost=0.0.0.0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#metricsProvider.httpPort=7000</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#metricsProvider.exportJvmInfo=true</span></span>
<span class="line"><span style="color:#FFCB6B;">audit.enable</span><span style="color:#A6ACCD;">=</span><span style="color:#82AAFF;">true</span></span></code></pre></div></li><li><p>启动 zookeeper</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bin</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">./zkServer.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看服务状态</span></span>
<span class="line"><span style="color:#FFCB6B;">./zkServer.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span></span></code></pre></div></li><li><p>连接 zookeeper</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./zkCli.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">localhost:2181</span></span></code></pre></div></li></ol>`,22),c=[t];function r(i,y,C,h,d,u){return a(),n("div",null,c)}const f=s(p,[["render",r]]);export{A as __pageData,f as default};
