import{_ as s,o as a,c as n,O as p}from"./chunks/framework.3938e08f.js";const l="/my-experience/assets/1.eb1010dd.jpg",d=JSON.parse('{"title":"pm2","description":"","frontmatter":{},"headers":[],"relativePath":"back-end/pm/index.md","filePath":"back-end/pm/index.md"}'),e={name:"back-end/pm/index.md"},o=p('<h1 id="pm2" tabindex="-1">pm2 <a class="header-anchor" href="#pm2" aria-label="Permalink to &quot;pm2&quot;">â€‹</a></h1><p><a href="https://pm2.fenxianglu.cn/docs/start" target="_blank" rel="noreferrer">PM2ä¸­æ–‡ç½‘</a> pm2æ˜¯nodeè¿›ç¨‹ç®¡ç†å·¥å…·ã€‚</p><h2 id="ç‰¹æ€§" tabindex="-1">ç‰¹æ€§ <a class="header-anchor" href="#ç‰¹æ€§" aria-label="Permalink to &quot;ç‰¹æ€§&quot;">â€‹</a></h2><p>1ã€åå°è¿è¡Œ æ™®é€šå¯åŠ¨æ–¹å¼ï¼šnode index.jsï¼Œå…³é—­ç»ˆç«¯å°±ç»“æŸè¿›ç¨‹ï¼› pm2å¯ä»¥åå°è¿è¡Œï¼Œç»ˆç«¯å…³é—­ä¸å½±å“ã€‚</p><p>2ã€è‡ªåŠ¨é‡å¯ å¯ä»¥ç›‘å¬æŸäº›æ–‡ä»¶æ”¹åŠ¨ï¼Œè‡ªåŠ¨é‡å¯</p><p>3ã€åœæ­¢ä¸ç¨³å®šçš„è¿›ç¨‹ é™åˆ¶ä¸ç¨³å®šçš„é‡å¯çš„æ¬¡æ•°ï¼Œè¾¾åˆ°ä¸Šé™å°±åœæ­¢è¿›ç¨‹ã€‚</p><p>4ã€0 ç§’åœæœºé‡å¯ é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¾¾åˆ°é‡å¯æ—¶ä¸åœæ­¢æœåŠ¡ã€‚</p><p>5ã€ç®€å•æ—¥å¿—ç®¡ç† pm2å¯ä»¥æ”¶é›†æ—¥å¿—ï¼Œå¹¶æœ‰æ’ä»¶é…åˆè¿›è¡Œç®¡ç†ã€‚åé¢ä¼šæåˆ°ã€‚</p><p>6ã€è‡ªåŠ¨è´Ÿè½½å‡è¡¡ clusteræ¨¡å¼ä¸‹ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨è½®è¯¢çš„æ–¹å¼è¾¾åˆ°è´Ÿè½½å‡è¡¡ï¼Œä»è€Œå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p>7ã€æä¾›å®æ—¶çš„æ¥å£ pm2æ’ä»¶æä¾›å®æ—¶çš„æ¥å£ï¼Œè¿”å›æœåŠ¡å™¨ä¸è¿›ç¨‹çš„ä¿¡æ¯ï¼Œåé¢ä¼šæåˆ°ã€‚</p><p>8ã€é›†æˆç®¡ç† å¯¹äºå¤šä¸ªè¿›ç¨‹ï¼Œä¸åŒç¯å¢ƒï¼Œå¯ä»¥ç»Ÿä¸€é…ç½®ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</p><h2 id="å®‰è£…" tabindex="-1">å®‰è£… <a class="header-anchor" href="#å®‰è£…" aria-label="Permalink to &quot;å®‰è£…&quot;">â€‹</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span></span></code></pre></div><p>æŸ¥çœ‹pm2çš„ä½ç½®</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">whereis</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pm2</span></span></code></pre></div><p>å¦‚æœè¿™æ—¶å€™è¿˜æ˜¯æ— æ³•è¿è¡Œï¼Œå¯ä»¥å°†nodeå®‰è£…ç›®å½•é‡Œé¢çš„binç›®å½•é‡Œé¢çš„å¿«æ·æ–¹å¼ï¼Œé“¾æ¥åˆ°è¿è¡Œç›®å½•å°±å¯ä»¥äº†ï¼Œå…·ä½“æ“ä½œæ–¹æ³•ï¼š</p><p>whereis pm2</p><p>å¾—åˆ°çš„ç›®å½•å°±æ˜¯pm2æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶ååŠ ä¸€ä¸ªå¿«æ·ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/software/nodejs/bin/pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/local/bin/</span></span></code></pre></div><h2 id="ä½¿ç”¨" tabindex="-1">ä½¿ç”¨ <a class="header-anchor" href="#ä½¿ç”¨" aria-label="Permalink to &quot;ä½¿ç”¨&quot;">â€‹</a></h2><ul><li>å¯åŠ¨è¿›ç¨‹:</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app.js</span></span></code></pre></div><p>å¾—åˆ°å¦‚ä¸‹å›¾ <img src="'+l+`" alt="è¿è¡Œç»“æœ"> ï¼ˆ1ï¼‰å…¶ä¸­app name å’Œidéƒ½æ˜¯è¿™ä¸ªè¿›ç¨‹çš„æ ‡è¯†ï¼Œå¯ä»¥å¯¹ä»–ä»¬è¿›è¡Œåˆ«çš„æ“ä½œï¼Œæ¯”å¦‚stopï¼Œdeleteç­‰ã€‚ ï¼ˆ2ï¼‰modeï¼šè¿›ç¨‹æ¨¡å¼ï¼Œclusteræˆ–forkã€‚clusteræœ‰å¤šä¸ªè¿›ç¨‹ï¼Œè€Œforkåªæœ‰ä¸€ä¸ªã€‚ ï¼ˆ3ï¼‰statusï¼šè¿›ç¨‹æ˜¯å¦åœ¨çº¿ ï¼ˆ4ï¼‰restartï¼šé‡å¯æ¬¡æ•° ï¼ˆ5ï¼‰uptimeï¼šè¿è¡Œæ—¶é—´ ï¼ˆ6ï¼‰cpuï¼šcpuå ç”¨ç‡ ï¼ˆ7ï¼‰memï¼šå†…å­˜å ç”¨å¤§å°</p><ul><li>åœæ­¢è¿›ç¨‹ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app_name</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">app_id</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">all</span></span></code></pre></div><ul><li>åˆ é™¤è¿›ç¨‹ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app_name</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">app_id</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">all</span></span></code></pre></div><ul><li>é‡å¯è¿›ç¨‹ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart/reload</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app_name</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">app_id</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">all</span></span></code></pre></div><p>é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œrestartä¸­æ–­æœåŠ¡ï¼Œè€Œreloadä¸ä¼š</p><ul><li>æŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">list/ls/status</span></span></code></pre></div><p>idç¼–å·ä»1~4çš„æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œåˆ†åˆ«å¯¹åº”4ä¸ªè¿›ç¨‹ã€‚</p><ul><li>æŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹çš„ä¿¡æ¯ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">show</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app_name</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">app_id</span></span></code></pre></div><p>statusï¼ˆçŠ¶æ€ï¼‰ã€restartsï¼ˆé‡å¯æ¬¡æ•°ï¼‰ã€uptimeï¼ˆè¿è¡Œæ—¶é—´ï¼‰ã€script pathï¼ˆå¯åŠ¨å…¥å£çš„è·¯å¾„ï¼‰ã€script argsï¼ˆå¯åŠ¨æ–‡ä»¶çš„å‚æ•°ï¼‰ã€error log pathï¼ˆé”™è¯¯æ—¥å¿—çš„è·¯å¾„ï¼‰ã€out log pathï¼ˆè¾“å‡ºæ—¥å¿—çš„è·¯å¾„ï¼‰ã€exec modeï¼ˆè¿›ç¨‹çš„æ¨¡å¼ï¼‰ã€watch&amp;reloadï¼ˆæ˜¯å¦å¼€å¯ç›‘å¬æ–‡ä»¶å˜åŠ¨é‡å¯ï¼‰ã€unstable restartsï¼ˆä¸ç¨³å®šçš„é‡å¯æ¬¡æ•°ï¼‰</p><p>heap sizeï¼ˆå †å†…å­˜ï¼‰ã€heap usageï¼ˆå †å†…å­˜ä½¿ç”¨ç‡ï¼‰ã€used heap sizeï¼ˆå †å†…å­˜ä½¿ç”¨æƒ…å†µï¼‰ã€event loop latencyï¼ˆäº‹ä»¶å¾ªç¯æ—¶å»¶ï¼‰ã€event loop latency p95ï¼ˆäº‹ä»¶å¾ªç¯æ—¶å»¶ ç¬¬95åˆ†ä½ï¼‰</p><ul><li>æŸ¥çœ‹æ—¥å¿—ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">logs</span></span></code></pre></div><ul><li>ç›‘æ§æ‰€æœ‰è¿›ç¨‹ï¼š</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">monit</span></span></code></pre></div><ul><li>å¯åŠ¨å‘½ä»¤ï¼ˆstartï¼‰è¿˜å¯ä»¥å¸¦å‚æ•° å…¶å®ƒå¯ç”¨é€‰é¡¹ï¼š</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">--watch ä»¥ç›‘å¬æ¨¡å¼å¯åŠ¨ï¼Œå½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨é‡å¯</span></span>
<span class="line"><span style="color:#A6ACCD;">--max-memory-restart &lt;200MB&gt; è®¾ç½®åº”ç”¨é‡è½½å ç”¨çš„æœ€å¤§å†…å­˜</span></span>
<span class="line"><span style="color:#A6ACCD;">--log &lt;log_path&gt; æŒ‡å®šæ—¥å¿—æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">-- arg1 arg2 arg3 ç»™å¯åŠ¨è„šæœ¬ä¼ é€’é¢å¤–çš„å‚æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">--restart-delay &lt;delay in ms&gt; å»¶æ—¶ x æ¯«ç§’è‡ªåŠ¨é‡å¯</span></span>
<span class="line"><span style="color:#A6ACCD;">--time æ—¥å¿—é‡Œæ·»åŠ æ—¶é—´å‰ç¼€</span></span>
<span class="line"><span style="color:#A6ACCD;">--no-autorestart ä¸è‡ªåŠ¨é‡å¯</span></span>
<span class="line"><span style="color:#A6ACCD;">--cron &lt;cron_pattern&gt; æŒ‰æŒ‡å®šçš„å®šæ—¶ä»»åŠ¡è§„åˆ™å¼ºåˆ¶é‡å¯</span></span>
<span class="line"><span style="color:#A6ACCD;">--no-daemon ä»¥éå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨</span></span></code></pre></div><p>å°ç»“ï¼š ä¸Šé¢ä»‹ç»çš„è¿™äº›å¯åŠ¨å…¶å®æœ‰å¼Šç«¯ï¼š 1ã€é€šè¿‡å‘½ä»¤è¡Œä¼ é€’å‚æ•°ï¼Œæ— æ³•è®°ä½åˆ°åº•ä¼ é€’è¿‡å“ªäº›å‚æ•°ã€‚ 2ã€å¯¹äºå¤šä¸ªè¿›ç¨‹ï¼Œä¸æ–¹ä¾¿ç®¡ç†ã€‚</p><p><a href="https://blog.csdn.net/leonnew/article/details/121989900" target="_blank" rel="noreferrer"></a></p><p>å¯åŠ¨</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app.js</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å¯åŠ¨app.jsåº”ç”¨ç¨‹åº</span></span>
<span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app.js</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># cluster mode æ¨¡å¼å¯åŠ¨4ä¸ªapp.jsçš„åº”ç”¨å®ä¾‹</span></span>
<span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app.js</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">api</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶å‘½åä¸º &quot;api&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app.js</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--watch</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å½“æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡å¯åº”ç”¨</span></span>
<span class="line"><span style="color:#FFCB6B;">pm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">script.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å¯åŠ¨ bash è„šæœ¬</span></span></code></pre></div><p>æŸ¥çœ‹ä¿¡æ¯</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 list # åˆ—è¡¨ PM2 å¯åŠ¨çš„æ‰€æœ‰çš„åº”ç”¨ç¨‹åº</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 monit # æ˜¾ç¤ºæ¯ä¸ªåº”ç”¨ç¨‹åºçš„CPUå’Œå†…å­˜å ç”¨æƒ…å†µ</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 show  id# æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä¿¡æ¯</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs # æ˜¾ç¤ºæ‰€æœ‰åº”ç”¨ç¨‹åºçš„æ—¥å¿—</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs id # æ˜¾ç¤ºæŒ‡å®šåº”ç”¨ç¨‹åºçš„æ—¥å¿—</span></span></code></pre></div><p>åœæ­¢</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 stop all # åœæ­¢æ‰€æœ‰çš„åº”ç”¨ç¨‹åº</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 stop 0 # åœæ­¢ idä¸º 0çš„æŒ‡å®šåº”ç”¨ç¨‹åº</span></span></code></pre></div><p>é‡å¯</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 restart all # é‡å¯æ‰€æœ‰åº”ç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 reload all # é‡å¯ cluster modeä¸‹çš„æ‰€æœ‰åº”ç”¨</span></span></code></pre></div><p>åˆ é™¤åº”ç”¨</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 delete all # å…³é—­å¹¶åˆ é™¤æ‰€æœ‰åº”ç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 delete 0 # åˆ é™¤æŒ‡å®šåº”ç”¨ id 0</span></span></code></pre></div><p>å…¶ä»–</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 gracefulReload all # Graceful reload all apps in cluster mode</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 scale api 10 # æŠŠåå­—å«apiçš„åº”ç”¨æ‰©å±•åˆ°10ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 reset [app-name] # é‡ç½®é‡å¯æ•°é‡</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 startup # åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 save # ä¿å­˜å½“å‰åº”ç”¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 resurrect # é‡æ–°åŠ è½½ä¿å­˜çš„åº”ç”¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 update # Save processes, kill PM2 and restore processes</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 generate # Generate a sample json configuration file</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 start app.js --node-args=&quot;--max-old-space-size=1024&quot;</span></span></code></pre></div><p>é‡ç½®é‡å¯æ¬¡æ•° pm2 reset PID //ä¸€æ¬¡åªèƒ½é‡ç½®ä¸€ä¸ª æŸ¥çœ‹</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨åº”ç”¨çš„åŸºæœ¬ä¿¡æ¯</span></span>
<span class="line"><span style="color:#A6ACCD;"># åŒ pm2 ls æˆ– pm2 status</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 list</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æŸ¥çœ‹æ‰€æœ‰åº”ç”¨çš„æ—¥å¿—ï¼ˆå†å² + å®æ—¶ï¼‰</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs www # åªæŸ¥çœ‹åº”ç”¨ www çš„æ—¥å¿—</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs --lines 10 # æŸ¥çœ‹æœ€å10æ¡å†å²ï¼Œé»˜è®¤ 15 æ¡</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs --timestamp # å®æ—¶æ—¥å¿—æ·»åŠ æ—¶é—´å‰ç¼€</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 logs www --lines 10 --err # åªæŸ¥çœ‹åº”ç”¨ www çš„æœ€æ–° 10 æ¡é”™è¯¯æ—¥å¿—</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 flush # â—ï¸æ¸…ç©ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 show app_name|app_id</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æŸ¥çœ‹æ¯ä¸ªåº”ç”¨çš„CPUå’Œå†…å­˜èµ„æºå®æ—¶å ç”¨æƒ…å†µ</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 monit</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># åœ¨çº¿çš„ Web è¯Šæ–­ç³»ç»Ÿï¼Œè·¨æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#A6ACCD;"># éœ€è¦æ³¨å†Œç™»å½•æˆ–ä½¿ç”¨ Githubã€Google è´¦æˆ·æˆæƒç™»å½•</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 monitor</span></span></code></pre></div><p>ç®¡ç†åº”ç”¨çŠ¶æ€</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># é‡å¯ â—ï¸</span></span>
<span class="line"><span style="color:#A6ACCD;"># åŒæ—¶æ€æ­»å¹¶é‡å¯æ‰€æœ‰è¿›ç¨‹ï¼ŒçŸ­æ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;"># ç”Ÿæˆç¯å¢ƒæ¨èä½¿ç”¨ reload</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 restart app_id|app_name|all</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># é‡è½½ ğŸ‘</span></span>
<span class="line"><span style="color:#A6ACCD;"># å§‹ç»ˆä¿æŒä¸€ä¸ªè¿›ç¨‹åœ¨çº¿ï¼Œé¿å…å®•æœº</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 reload app_id|app_name|all</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># åœæ­¢</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 stop app_id|app_name|all</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># å…³é—­å¹¶åˆ é™¤</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 delete app_id|app_name|all</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># ç›´æ¥æ€æ­» pm2 å®ˆæŠ¤è¿›ç¨‹</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 kill</span></span></code></pre></div><p>é™æ€æœåŠ¡å™¨</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># å°†ç›®å½• dist ä½œä¸ºé™æ€æœåŠ¡å™¨æ ¹ç›®å½•ï¼Œç«¯å£ä¸º 3333</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 serve ./dist 3333</span></span>
<span class="line"><span style="color:#A6ACCD;"> é›†ç¾¤æ¨¡å¼ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># max è¡¨ç¤º PM2 å°†è‡ªåŠ¨æ£€æµ‹å¯ç”¨ CPU çš„æ•°é‡å¹¶è¿è¡Œå°½å¯èƒ½å¤šçš„è¿›ç¨‹</span></span>
<span class="line"><span style="color:#A6ACCD;"># max å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœæ˜¯ 4 æ ¸ CPUï¼Œè®¾ç½®ä¸º 2 åˆ™åªå ç”¨ 2 æ ¸</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 start app.js -i max</span></span></code></pre></div><p>å¼€æœºè‡ªå¯åŠ¨</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 startup</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 unstartup</span></span></code></pre></div><p>åº”ç”¨åˆ—è¡¨</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># ä¿å­˜å½“å‰åº”ç”¨åˆ—è¡¨ï¼Œä»¥åå¯ä»¥æ¢å¤</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 save  # åŒ pm2 dump</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># é‡æ–°åŠ è½½ä¹‹å‰ä¿å­˜çš„åº”ç”¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 resurrect</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ¸…é™¤ä¿å­˜çš„åº”ç”¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 cleardump</span></span></code></pre></div><p>é…ç½®æ–‡ä»¶</p><p>ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">pm2 ecosystem # æˆ– pm2 init</span></span></code></pre></div><p>ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼ˆæ ¹æ®å®é™…é¡¹ç›®éœ€è¦æ·»åŠ ã€åˆ é™¤é…ç½®é¡¹ï¼‰</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">module.exports = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  apps : [{</span></span>
<span class="line"><span style="color:#A6ACCD;">  name      : &#39;demo&#39;,      // åº”ç”¨å</span></span>
<span class="line"><span style="color:#A6ACCD;">  script    : &#39;app.js&#39;,   // åº”ç”¨æ–‡ä»¶ä½ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">  env: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    PM2_SERVE_PATH: &quot;.&quot;,    // é™æ€æœåŠ¡è·¯å¾„</span></span>
<span class="line"><span style="color:#A6ACCD;">    PM2_SERVE_PORT: 8080,   // é™æ€æœåŠ¡å™¨è®¿é—®ç«¯å£</span></span>
<span class="line"><span style="color:#A6ACCD;">    NODE_ENV: &#39;development&#39; // è®¾ç½®å¼€å‘ç¯å¢ƒè¿è¡Œæ—¶</span></span>
<span class="line"><span style="color:#A6ACCD;">  },</span></span>
<span class="line"><span style="color:#A6ACCD;">  env_production : {</span></span>
<span class="line"><span style="color:#A6ACCD;">    NODE_ENV: &#39;production&#39;  // è®¾ç½®ç”Ÿäº§ç¯å¢ƒè¿è¡Œæ—¶</span></span>
<span class="line"><span style="color:#A6ACCD;">  },</span></span>
<span class="line"><span style="color:#A6ACCD;">  instances: &quot;max&quot;,         // å°†åº”ç”¨ç¨‹åºåˆ†å¸ƒåœ¨æ‰€æœ‰CPUæ ¸å¿ƒä¸Š,å¯ä»¥æ˜¯æ•´æ•°æˆ–è´Ÿæ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  watch: true,              // ç›‘å¬æ¨¡å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">  output: &#39;./out.log&#39;,      // æŒ‡å®šæ—¥å¿—æ ‡å‡†è¾“å‡ºæ–‡ä»¶åŠä½ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">  error: &#39;./error.log&#39;,     // é”™è¯¯è¾“å‡ºæ—¥å¿—æ–‡ä»¶åŠä½ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">  merge_logs: true,         // é›†ç¾¤æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆå¹¶æ—¥å¿—</span></span>
<span class="line"><span style="color:#A6ACCD;">  log_type: &quot;json&quot;,         // æ—¥å¿—ç±»å‹</span></span>
<span class="line"><span style="color:#A6ACCD;">  log_date_format: &quot;DD-MM-YYYY&quot;,  // æ—¥å¿—çš„æ—¥æœŸæ ¼å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">  }],</span></span>
<span class="line"><span style="color:#A6ACCD;">  deploy : {</span></span>
<span class="line"><span style="color:#A6ACCD;">    production : {</span></span>
<span class="line"><span style="color:#A6ACCD;">      user : &#39;SSH_USERNAME&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      host : &#39;SSH_HOSTMACHINE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      ref  : &#39;origin/master&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      repo : &#39;GIT_REPOSITORY&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      path : &#39;DESTINATION_PATH&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      &#39;pre-deploy-local&#39;: &#39;&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      &#39;post-deploy&#39; : &#39;npm install &amp;&amp; pm2 reload ecosystem.config.js --env production&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      &#39;pre-setup&#39;: &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>ä»¥é…ç½®æ–‡ä»¶å¯åŠ¨ç¤ºä¾‹</p><p>pm2 start ecosystem.config.js --env production âš ï¸ æ³¨æ„ï¼šé…ç½®æ–‡ä»¶æ”¯æŒ js å’Œ yaml æ ¼å¼ï¼Œè¿˜æœ‰ä¸€äº›æ²¡æœ‰åˆ—ä¸¾çš„å‚æ•°é¡¹ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pm2.keymetrics.io/docs/usage/application-declaration" target="_blank" rel="noreferrer">https://pm2.keymetrics.io/docs/usage/application-declaration</a></p><p>å‡çº§ PM2</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># æ›´æ–°å‰æ¨èå…ˆä¿å­˜å½“å‰åº”ç”¨åˆ—è¡¨ï¼Œæ–¹ä¾¿æ›´æ–°åç›´æ¥æ¢å¤</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 save</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ›´æ–°ä¸»ç¨‹åº</span></span>
<span class="line"><span style="color:#A6ACCD;">npm install pm2 -g</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># ç´§æ¥ç€æ›´æ–°å†…å­˜ä¸­çš„ç¨‹åº</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 update</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ¢å¤åº”ç”¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 resurrect</span></span></code></pre></div><p>æ—¥å¿—åˆ‡å‰²</p><p>å®‰è£… pm2-logrotate-ext æ‰©å±•æ¨¡å—</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/Lujo5/pm2-logrotate-ext" target="_blank" rel="noreferrer">https://github.com/Lujo5/pm2-logrotate-ext</a></p><p>pm2 install pm2-logrotate-ext é‡æ–°å¯åŠ¨åº”ç”¨åï¼Œpm2-logrotate-ext ä»¥æ¨¡å—çš„å½¢å¼è¢«åŠ è½½ã€å¯åŠ¨ã€‚</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯¹å…¶é…ç½®è¿›è¡Œä¿®æ”¹ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># å½“æ–‡ä»¶å¤§å°è¶…è¿‡æ­¤è®¾ç½®åˆ™æ‰§è¡Œåˆ‡å‰²</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:max_size 1M</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># ä¿ç•™æœ€æ–°çš„å‡ ä¸ªæ—¥å¿—æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:retain 30</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ˜¯å¦å¼€å¯ gzip å‹ç¼©</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:compress false</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ–‡ä»¶åçš„æ—¥æœŸéƒ¨åˆ†æ ¼å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:dateFormat YYYY-MM-DD_HH-mm-ss</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># å‡ ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ—¥å¿—æ–‡ä»¶å¤§å°</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:workerInterval 30</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># ç±»ä¼¼äºç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡ï¼Œå½“æ»¡è¶³æŒ‡å®šè§„åˆ™æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#A6ACCD;"># ä¸ç®¡æ—¥å¿—æ–‡ä»¶å¤§å°æ˜¯å¦è¾¾åˆ°è®¾ç½®çš„æœ€å¤§å€¼ï¼Œç›´æ¥å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œåˆ‡å‰²</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:rotateInterval 0 0 * * *</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># å¯¹ pm2 æ¨¡å—äº§ç”Ÿçš„æ—¥å¿—åŒæ ·è¿›è¡Œåˆ‡å‰²å¤„ç†</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:rotateModule true</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"># æ˜¯å¦æŒ‰å®šæ—¶ä»»åŠ¡è®¾ç½®è§„åˆ™å¼ºåˆ¶æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#A6ACCD;"># å¦‚æœè®¾ç½®ä¸ºå¦ï¼Œåˆ™åªæœ‰å½“æ—¥å¿—æ–‡ä»¶å¤§å°è¶…è¿‡è®¾ç½®æ—¶æ‰è¿›è¡Œåˆ‡å‰²</span></span>
<span class="line"><span style="color:#A6ACCD;">pm2 set pm2-logrotate-ext:forced true</span></span></code></pre></div>`,82),t=[o];function c(r,i,C,A,y,D){return a(),n("div",null,t)}const u=s(e,[["render",c]]);export{d as __pageData,u as default};
